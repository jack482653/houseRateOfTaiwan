<!DOCTYPE html>
<meta charset="utf-8">
<svg width="800px" height="600px" viewBox="0 0 800 600"></svg>
<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="https://d3js.org/topojson.v1.min.js"></script>
<script src="https://d3js.org/d3-array.v1.min.js"></script>
<script src="https://d3js.org/d3-collection.v1.min.js"></script>
<script src="https://d3js.org/d3-color.v1.min.js"></script>
<script src="https://d3js.org/d3-format.v1.min.js"></script>
<script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
<script src="https://d3js.org/d3-scale.v1.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
<script>
var features = null;
var jsonpath = "Taiwan.TopoJSON/topojson/counties.json";
(function() {
	var svg = d3.select('svg');
	var df = d3.format('.2f');
	var tip = d3.tip()
		.attr('class', 'd3-tip')
		.offset([-10, 0])
		.html(function(d) {
			return "<strong>" + d.properties.name +":</strong> <span style='color:red'>" + df(d.properties.density / 10000.0) + "Ëê¨</span>";
		});
	d3.json(jsonpath, function(error, data) {
		if (error) throw error;
		var features = topojson.feature(
			data, data.objects.map).features;
		d3.json('countrysAvg.json', function(error, avg) {
			var max = 0.0;
			for(i = 0; i < features.length; i++) {
				name = features[i].properties.name;
				features[i].properties.density = avg[name];
				max = (max < avg[name])?avg[name]:max;
			}
			var color = d3.scaleQuantize()
				.domain([0.0, max])
				.range(d3.schemeBlues[9]);
			var path = d3.geo.path().projection(
				 d3.geo.mercator()
				 .center([121,24])
				 .scale(6000)
			);
			var svg = d3.select('svg');
			svg.call(tip);
			svg.selectAll("path")
				.data(features).enter()
				.append("path").attr("d",path)
				.attr('fill', function(d) {
					return color(d.properties.density);
				}).on('mouseover', function(d, i) {
					d3.select(this).style(
						'fill-opacity', 0.7);
					tip.show(d);
				}).on('mouseout', function(d, i) {
					d3.selectAll('path').style({
						'fill-opacity':1.0
					});
					tip.hide(d);
				});

		});
	});
})();
</script>
